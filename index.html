<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!-- EXTREME COMPATIBILITY - ANDROID 2.3+ -->
<meta name="viewport" content="width=320, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>U¬∑BARCODE LEGACY</title>
<style>
/* ANDROID 2.3 SAFE RESET - NO ADVANCED SELECTORS */
* { margin: 0; padding: 0; border: 0; }
body { 
    background: #000000; 
    font-family: sans-serif; 
    margin: 0; 
    padding: 0; 
    height: 100%; 
}
#phone {
    width: 320px;
    height: 480px; /* Standard old Android size */
    background: #2b4b70;
    color: #ffffff;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
    border: 2px solid #1f3f5c;
}
/* NO FLEXBOX - USING OLD SCHOOL POSITIONING */
#header {
    height: 35px;
    background: #2e5a88;
    border-bottom: 2px solid #1f3f5c;
    padding: 5px 8px 0 8px;
    position: relative;
}
#leftText {
    float: left;
    font-size: 16px;
    font-weight: bold;
    color: #ffffff;
    padding-top: 5px;
}
#rightArea {
    float: right;
}
#gpsIndicator, #flashIndicator, #timeDisplay {
    display: inline-block;
    color: #ffffff;
    font-size: 14px;
    margin-left: 5px;
    vertical-align: middle;
}
#flashIndicator {
    background: #000000;
    padding: 2px 8px;
    border-radius: 3px;
    cursor: pointer;
}
/* BUTTON - ABSOLUTELY NO CSS3 TRICKS */
#scanBtn {
    width: 300px;
    height: 45px;
    background: #2b6e2f;
    border: 2px solid #1e5a22;
    color: #ffffff;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
    line-height: 45px;
    margin: 8px auto;
    cursor: pointer;
    border-radius: 5px;
    box-shadow: 0 4px 0 #145018;
}
#scanBtn:active {
    background: #1e5a22;
    margin-top: 10px;
    box-shadow: 0 2px 0 #145018;
}
#scanFrame {
    width: 300px;
    height: 160px;
    background: #000000;
    border: 3px solid #ffcc00;
    margin: 0 auto;
    position: relative;
    display: none;
}
#preview {
    width: 100%;
    height: 100%;
    background: #000000;
}
/* CORNERS USING ABSOLUTE */
.corner {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 3px solid #ffcc00;
}
.tl { top: 0; left: 0; border-right: none; border-bottom: none; }
.tr { top: 0; right: 0; border-left: none; border-bottom: none; }
.bl { bottom: 0; left: 0; border-right: none; border-top: none; }
.br { bottom: 0; right: 0; border-left: none; border-top: none; }
#torchBtn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #000000;
    color: #ffcc00;
    padding: 3px 10px;
    border: 1px solid #ffcc00;
    font-size: 12px;
    cursor: pointer;
    z-index: 10;
}
#labelBlock {
    width: 300px;
    margin: 0 auto;
}
#labelTitle {
    background: #2b4b70;
    border: 1px solid #1f3f5c;
    padding: 5px;
    font-size: 14px;
    font-weight: bold;
}
#labelBox {
    width: 290px;
    height: 70px;
    background: #a6beef;
    border: 3px solid #1f3f5c;
    padding: 3px;
    margin: 3px auto;
    overflow-y: scroll;
    color: #000000;
    font-family: monospace;
}
#labelBox span {
    display: block;
    background: #c0d4f5;
    padding: 2px;
    margin: 2px 0;
    border-bottom: 1px solid #2b4b70;
    font-size: 12px;
}
#labelButtons {
    height: 35px;
    background: #7496c4;
    border: 2px solid #3a5f8a;
    margin: 5px 0;
    line-height: 35px;
    text-align: center;
}
#labelButtons span {
    display: inline-block;
    padding: 0 15px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
}
#navBar {
    height: 30px;
    background: #2b4b70;
    border: 1px solid #1f3f5c;
    margin: 5px 0;
    line-height: 30px;
    text-align: center;
}
#navBar button {
    background: none;
    color: #ffffff;
    font-size: 20px;
    padding: 0 15px;
    cursor: pointer;
    border: none;
}
/* KEYPAD - TABLE BASED FOR MAX COMPAT */
#keypadWrapper {
    background: #1f3f5c;
    border-top: 3px solid #ffcc00;
    padding: 5px 0;
    width: 100%;
}
#keyTabs {
    text-align: center;
    margin: 5px 0;
}
#keyTabs button {
    width: 80px;
    height: 35px;
    background: #3a5f8a;
    border: 2px solid #1f3f5c;
    color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    margin: 0 2px;
    cursor: pointer;
    border-radius: 20px;
}
#keyTabs button.active {
    background: #4caf50;
    border-color: #145018;
}
.pad {
    width: 300px;
    margin: 0 auto;
}
.pad table {
    width: 100%;
    border-collapse: collapse;
}
.pad td {
    padding: 3px;
}
.pad button {
    width: 100%;
    height: 45px;
    background: #3a5f8a;
    border: 2px solid #1f3f5c;
    color: #ffffff;
    font-size: 22px;
    font-weight: bold;
    cursor: pointer;
    border-radius: 5px;
    box-shadow: 0 3px 0 #1f3f5c;
}
.pad button:active {
    background: #4caf50;
    margin-top: 2px;
    box-shadow: 0 1px 0 #1f3f5c;
}
.backspace-btn {
    background: #b94a48 !important;
}
.special-btn {
    background: #2b4b70 !important;
    font-size: 18px !important;
}
#numericPad, #qwertyPad, #symbolPad {
    width: 300px;
    margin: 0 auto;
}
#qwertyPad, #symbolPad {
    display: none;
}
.qwerty-row {
    margin: 2px 0;
    text-align: center;
}
.qwerty-row button {
    width: 28px;
    height: 40px;
    background: #3a5f8a;
    border: 2px solid #1f3f5c;
    color: #ffffff;
    font-size: 16px;
    margin: 1px;
    cursor: pointer;
    border-radius: 3px;
    vertical-align: top;
}
.qwerty-row .wide-btn {
    width: 80px;
}
.qwerty-row .space-btn {
    width: 120px;
}
/* STATUS SCREEN */
#statusScreen {
    position: absolute;
    top: 45px;
    left: 0;
    width: 320px;
    height: 435px;
    background: #1c3046;
    z-index: 100;
    overflow-y: scroll;
    display: none;
    padding: 5px 0;
}
.statBtn {
    width: 290px;
    background: #2b4b70;
    border: 3px solid #ffcc00;
    color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    padding: 12px 0;
    margin: 5px auto;
    text-align: center;
    cursor: pointer;
    border-radius: 5px;
}
.statBtn:active {
    background: #4caf50;
}
.backBtn {
    border-color: #ffaa00;
    background: #1f3f5c;
}
/* POPUP */
#successPopup {
    position: absolute;
    top: 0;
    left: 0;
    width: 320px;
    height: 480px;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    display: none;
}
.popup {
    width: 250px;
    background: #2b4b70;
    border: 5px solid #27ae60;
    margin: 100px auto 0;
    padding: 15px;
    text-align: center;
    border-radius: 15px;
}
.check {
    width: 50px;
    height: 50px;
    background: #27ae60;
    border-radius: 25px;
    margin: 0 auto 10px;
    font-size: 30px;
    line-height: 50px;
    color: #ffffff;
}
#popupStatus {
    color: #ffcc00;
    font-size: 14px;
    margin: 5px 0;
}
#popupScanCount {
    font-size: 12px;
}
/* CLEAR FLOATS */
.clear { clear: both; }
</style>
<!-- OLD SCHOOL ZXING CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/zxing-js/0.0.1/ZXing.js"></script>
</head>
<body>
<div id="phone">
    <div id="header">
        <span id="leftText">SCAN QR</span>
        <span id="rightArea">
            <span id="flashIndicator" onclick="toggleFlashLegacy()">üî¶</span>
            <span id="gpsIndicator">üìç</span>
            <span id="timeDisplay"></span>
        </span>
        <div class="clear"></div>
    </div>
    
    <div id="scanBtn" onclick="startScanLegacy()">üì∑ SCAN BARCODE</div>
    
    <div id="scanFrame">
        <video id="preview" autoplay playsinline style="width:100%;height:100%;"></video>
        <div id="torchBtn" onclick="toggleFlashLegacy()">üî¶ OFF</div>
        <div class="corner tl"></div>
        <div class="corner tr"></div>
        <div class="corner bl"></div>
        <div class="corner br"></div>
    </div>
    
    <div id="labelBlock">
        <div id="labelTitle">üìã SCANNED CODES</div>
        <div id="labelBox"></div>
        <div id="labelButtons">
            <span onclick="clearAllLegacy()">CLEAR</span> | 
            <span onclick="showStatusLegacy()">ENTER</span>
        </div>
        <div id="navBar">
            <button onclick="alert('Prev')">‚óÄ</button>
            <span id="timeDisplay2"></span>
            <button onclick="alert('Next')">‚ñ∂</button>
        </div>
        
        <div id="keypadWrapper">
            <div id="keyTabs">
                <button id="tabQ" onclick="showPadLegacy('q')">ABC</button>
                <button id="tabN" onclick="showPadLegacy('n')" class="active">123</button>
                <button id="tabS" onclick="showPadLegacy('s')">#+='</button>
            </div>
            
            <!-- NUMERIC PAD -->
            <div id="numericPad" class="pad">
                <table>
                    <tr><td><button onclick="addChar('1')">1</button></td><td><button onclick="addChar('2')">2</button></td><td><button onclick="addChar('3')">3</button></td></tr>
                    <tr><td><button onclick="addChar('4')">4</button></td><td><button onclick="addChar('5')">5</button></td><td><button onclick="addChar('6')">6</button></td></tr>
                    <tr><td><button onclick="addChar('7')">7</button></td><td><button onclick="addChar('8')">8</button></td><td><button onclick="addChar('9')">9</button></td></tr>
                    <tr><td><button onclick="addChar('.')">.</button></td><td><button onclick="addChar('0')">0</button></td><td><button class="backspace-btn" onclick="backspaceLegacy()">‚å´</button></td></tr>
                </table>
            </div>
            
            <!-- QWERTY PAD -->
            <div id="qwertyPad">
                <div class="qwerty-row">
                    <button onclick="addChar('q')">q</button><button onclick="addChar('w')">w</button><button onclick="addChar('e')">e</button><button onclick="addChar('r')">r</button><button onclick="addChar('t')">t</button><button onclick="addChar('y')">y</button><button onclick="addChar('u')">u</button><button onclick="addChar('i')">i</button><button onclick="addChar('o')">o</button><button onclick="addChar('p')">p</button>
                </div>
                <div class="qwerty-row">
                    <button onclick="addChar('a')">a</button><button onclick="addChar('s')">s</button><button onclick="addChar('d')">d</button><button onclick="addChar('f')">f</button><button onclick="addChar('g')">g</button><button onclick="addChar('h')">h</button><button onclick="addChar('j')">j</button><button onclick="addChar('k')">k</button><button onclick="addChar('l')">l</button>
                </div>
                <div class="qwerty-row">
                    <button onclick="addChar('z')">z</button><button onclick="addChar('x')">x</button><button onclick="addChar('c')">c</button><button onclick="addChar('v')">v</button><button onclick="addChar('b')">b</button><button onclick="addChar('n')">n</button><button onclick="addChar('m')">m</button>
                    <button class="backspace-btn" onclick="backspaceLegacy()">‚å´</button>
                </div>
                <div class="qwerty-row">
                    <button class="wide-btn" onclick="showPadLegacy('n')">123</button>
                    <button class="space-btn" onclick="addChar(' ')">space</button>
                    <button class="wide-btn" onclick="addChar('.')">.</button>
                </div>
            </div>
            
            <!-- SYMBOL PAD -->
            <div id="symbolPad">
                <div class="qwerty-row">
                    <button onclick="addChar('@')">@</button><button onclick="addChar('#')">#</button><button onclick="addChar('$')">$</button><button onclick="addChar('%')">%</button><button onclick="addChar('&')">&</button><button onclick="addChar('*')">*</button>
                </div>
                <div class="qwerty-row">
                    <button onclick="addChar('(')">(</button><button onclick="addChar(')')">)</button><button onclick="addChar('-')">-</button><button onclick="addChar('+')">+</button><button onclick="addChar('=')">=</button><button onclick="addChar('/')">/</button>
                </div>
                <div class="qwerty-row">
                    <button onclick="addChar(':')">:</button><button onclick="addChar(';')">;</button><button onclick="addChar('"')">"</button><button onclick="addChar("'")">'</button><button onclick="addChar(',')">,</button>
                    <button class="backspace-btn" onclick="backspaceLegacy()">‚å´</button>
                </div>
                <div class="qwerty-row">
                    <button class="wide-btn" onclick="showPadLegacy('q')">ABC</button>
                    <button class="space-btn" onclick="addChar(' ')">space</button>
                    <button class="wide-btn" onclick="addChar('.')">.</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="statusScreen">
        <div class="statBtn" onclick="submitStatusLegacy('Data Received (+7)')">üì¶ Data Received (+7)</div>
        <div class="statBtn" onclick="submitStatusLegacy('Picked Up (-1)')">üì¨ Picked Up (-1)</div>
        <div class="statBtn" onclick="submitStatusLegacy('Depart Post Office (-2)')">üöö Depart PO (-2)</div>
        <div class="statBtn" onclick="submitStatusLegacy('Arrival Scan (-0.5)')">üìç Arrival Scan (-0.5)</div>
        <div class="statBtn" onclick="submitStatusLegacy('Local Scan (-1.5)')">üè¢ Local Scan (-1.5)</div>
        <div class="statBtn" onclick="submitStatusLegacy('Out For Delivery (-2)')">üöõ Out For Delivery (-2)</div>
        <div class="statBtn" onclick="submitStatusLegacy('Delivered (0)')">‚úÖ Delivered (0)</div>
        <div class="statBtn backBtn" onclick="hideStatusLegacy()">‚óÄ BACK TO SCAN</div>
    </div>
    
    <div id="successPopup">
        <div class="popup">
            <div class="check">‚úì</div>
            <div id="popupMessage" style="font-size:18px;margin:10px 0;">Success!</div>
            <div id="popupStatus"></div>
            <div id="popupScanCount"></div>
        </div>
    </div>
</div>

<script>
// ========== LEGACY ANDROID 2.3+ COMPATIBLE CODE ==========
// NO LET, NO CONST, NO ARROW FUNCTIONS, NO PROMISES, NO FETCH

// Global variables
var stream = null;
var scanning = false;
var scanCount = 0;
var scans = [];
var gps = null;
var watchId = null;
var videoElement = document.getElementById('preview');
var frame = document.getElementById('scanFrame');
var box = document.getElementById('labelBox');
var leftTxt = document.getElementById('leftText');
var gpsInd = document.getElementById('gpsIndicator');
var torchBtn = document.getElementById('torchBtn');
var flashInd = document.getElementById('flashIndicator');
var statusScreen = document.getElementById('statusScreen');
var labelBlock = document.getElementById('labelBlock');
var scanBtn = document.getElementById('scanBtn');
var successPopup = document.getElementById('successPopup');
var popupStatus = document.getElementById('popupStatus');
var popupScanCount = document.getElementById('popupScanCount');

// Xano URL
var XANO_URL = 'https://x8ki-letl-twmt.n7.xano.io/api:WGx5FQAG/qr_scans';

// ========== CLOCK UPDATE ==========
function updateTime() {
    var d = new Date();
    var month = (d.getMonth() + 1);
    if (month < 10) month = '0' + month;
    var day = d.getDate();
    if (day < 10) day = '0' + day;
    var hours = d.getHours();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    if (hours == 0) hours = 12;
    var mins = d.getMinutes();
    if (mins < 10) mins = '0' + mins;
    var timeStr = month + '/' + day + ' ' + hours + ':' + mins + ' ' + ampm;
    
    document.getElementById('timeDisplay').innerHTML = timeStr;
    document.getElementById('timeDisplay2').innerHTML = timeStr;
}
setInterval(updateTime, 1000);

// ========== GPS ==========
function updateGPSIndicator(hasFix) {
    if (hasFix) {
        gpsInd.innerHTML = 'üõ∞Ô∏è';
        gpsInd.style.color = '#4CAF50';
    } else {
        gpsInd.innerHTML = 'üåê';
        gpsInd.style.color = '#ff4444';
    }
}

function initGPS() {
    if (!navigator.geolocation) {
        updateGPSIndicator(false);
        return;
    }
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            gps = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                acc: position.coords.accuracy
            };
            updateGPSIndicator(true);
        },
        function(error) {
            updateGPSIndicator(false);
        },
        { enableHighAccuracy: true, timeout: 8000 }
    );
    
    watchId = navigator.geolocation.watchPosition(
        function(position) {
            gps = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                acc: position.coords.accuracy
            };
            updateGPSIndicator(true);
        },
        function(error) {
            updateGPSIndicator(false);
        },
        { enableHighAccuracy: true, timeout: 8000 }
    );
}

// ========== CAMERA ==========
function stopCam() {
    if (stream) {
        try {
            var tracks = stream.getTracks();
            for (var i = 0; i < tracks.length; i++) {
                tracks[i].stop();
            }
        } catch(e) {}
        stream = null;
    }
    scanning = false;
}

function startScanLegacy() {
    if (scanning) {
        stopCam();
        frame.style.display = 'none';
        return;
    }
    
    scanning = true;
    frame.style.display = 'block';
    torchBtn.innerHTML = 'üî¶ OFF';
    
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Camera not supported on this device');
        stopCam();
        frame.style.display = 'none';
        return;
    }
    
    navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: 'environment' } 
    }).then(function(s) {
        stream = s;
        videoElement.srcObject = stream;
        videoElement.play();
        
        // Use legacy ZXing
        try {
            var codeReader = new ZXing.BrowserMultiFormatReader();
            codeReader.decodeFromVideoElement(videoElement, function(result, err) {
                if (result) {
                    onDecodeLegacy(result.getText(), result.getBarcodeFormat());
                    codeReader.reset();
                    stopCam();
                    frame.style.display = 'none';
                }
            });
        } catch(e) {
            alert('Scanner error: ' + e.message);
            stopCam();
            frame.style.display = 'none';
        }
    }).catch(function(err) {
        alert('Camera error: ' + err.message);
        stopCam();
        frame.style.display = 'none';
    });
}

// ========== DECODE HANDLER ==========
function onDecodeLegacy(code, type) {
    // Beep
    try {
        var audio = new Audio();
        audio.src = 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVoAAACAgICAf39/f3+AgIAAAACAgIAAAAAAAAAAAAD//wAAgIAAAAD//wAAgIAAAAD//wAAgID//wAAgID//wAAgIAAAAD//wAA';
        audio.play();
    } catch(e) {}
    
    scanCount++;
    var scanObj = {
        num: scanCount,
        code: code,
        type: type || 'QR_CODE',
        time: new Date().toISOString(),
        loc: gps
    };
    scans.push(scanObj);
    
    var span = document.createElement('span');
    var gpsIcon = gps ? ' üìç' : '';
    span.innerHTML = scanCount + ' ' + code + gpsIcon + ' [' + (type || 'QR') + ']';
    box.appendChild(span);
    box.scrollTop = box.scrollHeight;
}

// ========== CLEAR ==========
function clearAllLegacy() {
    scanCount = 0;
    scans = [];
    box.innerHTML = '';
}

// ========== STATUS SCREEN ==========
function showStatusLegacy() {
    if (scans.length == 0) {
        alert('Scan a barcode first');
        return;
    }
    labelBlock.style.display = 'none';
    scanBtn.style.display = 'none';
    leftTxt.innerHTML = 'SELECT STATUS';
    statusScreen.style.display = 'block';
}

function hideStatusLegacy() {
    statusScreen.style.display = 'none';
    labelBlock.style.display = 'block';
    scanBtn.style.display = 'block';
    leftTxt.innerHTML = 'SCAN QR';
}

// ========== ETA CALC ==========
function calculateETA(status) {
    var d = new Date();
    if (status.indexOf('Received') > -1) {
        d.setDate(d.getDate() + 7);
    } else if (status.indexOf('Picked') > -1) {
        d.setDate(d.getDate() - 1);
    } else if (status.indexOf('Depart') > -1) {
        d.setDate(d.getDate() - 2);
    } else if (status.indexOf('Arrival') > -1) {
        d.setHours(d.getHours() - 12);
    } else if (status.indexOf('Local') > -1) {
        d.setHours(d.getHours() - 36);
    } else if (status.indexOf('Out') > -1) {
        d.setDate(d.getDate() - 2);
    }
    return (d.getMonth()+1) + '/' + d.getDate() + ' ' + d.getHours() + ':' + 
           (d.getMinutes() < 10 ? '0' : '') + d.getMinutes();
}

// ========== SUBMIT STATUS ==========
function submitStatusLegacy(statusText) {
    if (scans.length == 0) return;
    
    // Try to get fresh GPS
    if (!gps && navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                gps = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                doSubmit(statusText);
            },
            function() {
                doSubmit(statusText);
            }
        );
    } else {
        doSubmit(statusText);
    }
}

function doSubmit(statusText) {
    var packs = [];
    for (var i = 0; i < scans.length; i++) {
        var s = scans[i];
        var eta = calculateETA(statusText);
        packs.push({
            LABEL_ID: s.code,
            BARCODE_TYPE: s.type,
            TIME: new Date().toLocaleTimeString(),
            DATE: new Date().toLocaleDateString(),
            STATUS: statusText,
            LOCATION: gps ? gps.lat + ',' + gps.lng : 'unavailable',
            ETA: eta,
            TIMESTAMP: new Date().toISOString()
        });
    }
    
    var body = {
        scans: packs,
        status: statusText,
        timestamp: new Date().toISOString(),
        location: gps,
        batch_id: new Date().getTime() + ''
    };
    
    // Use XMLHttpRequest for max compatibility
    var xhr = new XMLHttpRequest();
    xhr.open('POST', XANO_URL, true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            if (xhr.status == 200 || xhr.status == 201) {
                showPopup(statusText, packs);
            } else {
                alert('Server error: ' + xhr.status);
            }
        }
    };
    xhr.onerror = function() {
        alert('Network error - check connection');
    };
    xhr.send(JSON.stringify(body));
}

function showPopup(status, packs) {
    var html = '';
    for (var i = 0; i < packs.length; i++) {
        html += packs[i].LABEL_ID.substring(0,8) + '‚Ä¶ ETA:' + packs[i].ETA + '<br>';
    }
    popupStatus.innerHTML = 'Status: ' + status;
    popupScanCount.innerHTML = scanCount + ' QR(s)<br>' + html;
    successPopup.style.display = 'block';
    
    setTimeout(function() {
        successPopup.style.display = 'none';
        clearAllLegacy();
        hideStatusLegacy();
    }, 4000);
}

// ========== KEYPAD FUNCTIONS ==========
function addChar(c) {
    var span = document.createElement('span');
    span.innerHTML = c;
    box.appendChild(span);
    box.scrollTop = box.scrollHeight;
}

function backspaceLegacy() {
    if (box.lastChild) {
        box.removeChild(box.lastChild);
    }
}

function showPadLegacy(mode) {
    document.getElementById('numericPad').style.display = 'none';
    document.getElementById('qwertyPad').style.display = 'none';
    document.getElementById('symbolPad').style.display = 'none';
    
    document.getElementById('tabN').className = '';
    document.getElementById('tabQ').className = '';
    document.getElementById('tabS').className = '';
    
    if (mode == 'n') {
        document.getElementById('numericPad').style.display = 'block';
        document.getElementById('tabN').className = 'active';
    } else if (mode == 'q') {
        document.getElementById('qwertyPad').style.display = 'block';
        document.getElementById('tabQ').className = 'active';
    } else {
        document.getElementById('symbolPad').style.display = 'block';
        document.getElementById('tabS').className = 'active';
    }
}

// ========== FLASH ==========
function toggleFlashLegacy() {
    if (!stream) return;
    var track = stream.getVideoTracks()[0];
    if (!track || !track.applyConstraints) return;
    
    var isOn = torchBtn.innerHTML.indexOf('OFF') > -1;
    torchBtn.innerHTML = isOn ? 'üî¶ ON' : 'üî¶ OFF';
    
    try {
        track.applyConstraints({ advanced: [{ torch: isOn }] });
    } catch(e) {}
}

// ========== INIT ==========
window.onload = function() {
    initGPS();
    updateTime();
    showPadLegacy('n'); // Show numeric pad by default
};

// Cleanup
window.onbeforeunload = function() {
    if (watchId) {
        navigator.geolocation.clearWatch(watchId);
    }
    stopCam();
};
</script>
</body>
</html>
