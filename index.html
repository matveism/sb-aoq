<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Scanner UI</title>

  <meta name="viewport"
        content="width=360, height=640, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      overflow: hidden;
    }

    #phone {
      width: 360px;
      height: 640px;
      background-color: #0B173B;
      font-family: "Courier New", monospace;
      color: #FFFFFF;
      overflow: hidden;
      position: relative;
    }

    /* GLASSY MESH */
    #pattern {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      background-image:
        linear-gradient(to bottom,
          rgba(255,255,255,0.08) 0%,
          rgba(255,255,255,0.00) 40%,
          rgba(255,255,255,0.06) 60%,
          rgba(255,255,255,0.00) 100%
        ),
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.00) 60%);
      background-size: 100% 100%, 32px 32px, 32px 32px, 100% 100%;
      opacity: 0.35;
    }

    /* HEADER */
    #header {
      width: 100%;
      height: 32px;
      background-color: #1A2C55;
      border-bottom: 1px solid #000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 10px;
      box-sizing: border-box;
      position: relative;
      z-index: 2;
    }

    #leftText { font-weight: bold; font-size: 15px; }
    #rightArea { font-size: 14px; }

    /* SCAN BUTTON */
    #scanButton {
      width: calc(100% - 20px);
      height: 48px;
      background-color: #0A8A2A;
      border: 2px solid #0F5F1C;
      color: #FFFFFF;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      line-height: 48px;
      margin: 12px auto 0 auto;
      border-radius: 4px;
      position: relative;
      z-index: 2;
      box-shadow: 0 0 6px rgba(0,0,0,0.4);
    }

    /* SCAN FRAME */
    #scanFrame {
      width: 280px;
      height: 160px;
      border: 2px solid rgba(255,255,255,0.4);
      margin: 20px auto 0 auto;
      position: relative;
      display: none;
      z-index: 3;
      overflow: hidden;
    }

    #preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* LASER */
    #laser {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: rgba(255,0,0,0.8);
      box-shadow: 0 0 6px red;
      animation: laserMove 2s linear infinite;
      display: none;
      z-index: 5;
    }

    @keyframes laserMove {
      0%   { top: 0; }
      50%  { top: 158px; }
      100% { top: 0; }
    }

    /* Corners */
    .corner {
      width: 20px;
      height: 20px;
      border: 3px solid #00FFAA;
      position: absolute;
      pointer-events: none;
    }
    .tl { top: -3px; left: -3px; border-right: none; border-bottom: none; }
    .tr { top: -3px; right: -3px; border-left: none; border-bottom: none; }
    .bl { bottom: -3px; left: -3px; border-right: none; border-top: none; }
    .br { bottom: -3px; right: -3px; border-left: none; border-top: none; }

    /* BARCODE LABEL */
    #barcodeLabel {
      width: 100%;
      height: 32px;
      background-color: #1A2C55;
      border-top: 1px solid #000;
      border-bottom: 1px solid #000;
      display: none;
      align-items: center;
      padding-left: 10px;
      font-weight: bold;
      font-size: 15px;
      box-sizing: border-box;
      margin-top: 12px;
      z-index: 2;
      position: relative;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

  <script>
    let stream = null;
    let scanning = false;

    function updateTime() {
      const now = new Date();
      const h = now.getHours();
      let m = now.getMinutes();
      if (m < 10) m = "0" + m;
      document.getElementById("rightArea").innerHTML = h + ":" + m;
    }
    setInterval(updateTime, 1000);
    window.onload = updateTime;

    async function startScan() {
      if (scanning) return;
      scanning = true;

      document.getElementById("barcodeLabel").style.display = "none";
      document.getElementById("scanFrame").style.display = "block";
      document.getElementById("laser").style.display = "block";

      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
      });

      const video = document.getElementById("preview");
      video.srcObject = stream;
      await video.play();

      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      function tick() {
        if (!scanning) return;

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const qr = jsQR(imageData.data, canvas.width, canvas.height);

        if (qr) {
          onBarcodeDecoded(qr.data);
          return;
        }

        requestAnimationFrame(tick);
      }

      tick();
    }

    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
    }

    function onBarcodeDecoded(code) {
      scanning = false;
      stopCamera();

      document.getElementById("scanFrame").style.display = "none";
      document.getElementById("laser").style.display = "none";

      document.getElementById("beep").play();

      const label = document.getElementById("barcodeLabel");
      label.style.display = "flex";
      label.innerHTML = "# BARCODE ID: " + code;
    }
  </script>

</head>

<body>

  <div id="phone">

    <div id="pattern"></div>

    <div id="header">
      <div id="leftText">SCAN BARCODE</div>
      <div id="rightArea"></div>
    </div>

    <div id="scanButton" onclick="startScan()">SCAN</div>

    <div id="scanFrame">
      <video id="preview" playsinline></video>
      <div id="laser"></div>
      <div class="corner tl"></div>
      <div class="corner tr"></div>
      <div class="corner bl"></div>
      <div class="corner br"></div>
    </div>

    <div id="barcodeLabel"></div>

    <!-- BEEP -->
    <audio id="beep" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="></audio>

  </div>

</body>
</html>
